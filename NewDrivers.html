<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Driver Records</title>
<style>
body {
font-family: 'Segoe UI', Tahoma, sans-serif;
background: #f4f7f5;
padding: 30px;
color: #1f2933;
}
h1 {
color: #0b3d2e;
border-bottom: 4px solid #1f7a4d;
padding-bottom: 10px;
}
h2 { color: #0b3d2e; margin-top: 30px; }
.form-section {
display: flex;
gap: 20px;
align-items: flex-start;
margin-bottom: 30px;
}
form {
background: #ffffff;
padding: 20px;
border-radius: 8px;
box-shadow: 0 4px 12px rgba(0,0,0,0.08);
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 15px;
flex: 1;
max-width: 700px;
}
.sidebar {
display: flex;
flex-direction: column;
gap: 20px;
min-width: 180px;
}
.record-counter {
background: #ffffff;
padding: 0;
border-radius: 8px;
box-shadow: 0 4px 12px rgba(0,0,0,0.08);
text-align: center;
overflow: hidden;
}
.record-counter h3 {
margin: 0;
padding: 10px;
background: #0b3d2e;
color: #ffffff;
font-size: 0.9rem;
text-transform: uppercase;
letter-spacing: 0.05em;
}
.record-counter .count {
font-size: 2.5rem;
font-weight: bold;
color: #1f7a4d;
margin: 20px 0 10px 0;
}
.record-counter .label {
font-size: 0.85rem;
color: #666;
margin-bottom: 20px;
}
.import-export-box {
background: #ffffff;
padding: 15px;
border-radius: 8px;
box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}
.import-export-box h3 {
margin: 0 0 12px 0;
color: #0b3d2e;
font-size: 0.9rem;
text-transform: uppercase;
letter-spacing: 0.05em;
}
.csv-buttons {
display: flex;
flex-direction: column;
gap: 8px;
}
.csv-buttons button {
padding: 10px 15px;
font-size: 0.85rem;
background: #1f7a4d;
color: #ffffff;
border: none;
border-radius: 4px;
cursor: pointer;
}
.csv-buttons button:hover {
background: #155c3a;
}
label { font-weight: 600; font-size: 0.9rem; }
input, select {
padding: 8px;
border-radius: 4px;
border: 1px solid #cbd5d6;
}
button {
grid-column: span 2;
background: #1f7a4d;
color: #ffffff;
border: none;
padding: 12px;
font-size: 1rem;
border-radius: 4px;
cursor: pointer;
}
button:hover { background: #155c3a; }
table {
width: 100%;
border-collapse: collapse;
background: #ffffff;
box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}
th, td {
padding: 10px;
border-bottom: 1px solid #e2e8f0;
text-align: left;
}
th {
background: #0b3d2e;
color: #ffffff;
text-transform: uppercase;
font-size: 0.75rem;
letter-spacing: 0.05em;
position: relative;
user-select: none;
}
th.sortable {
cursor: pointer;
padding-right: 25px;
}
th.sortable:hover {
background: #0d4a38;
}
th .sort-arrow {
position: absolute;
right: 8px;
top: 50%;
transform: translateY(-50%);
font-size: 0.7rem;
opacity: 0.7;
}
tr:hover { background: #f0fdf4; }
tr.duplicate-driver { 
background-color: #ff4444 !important;
color: #ffffff;
font-weight: 600;
}
tr.duplicate-driver td {
border-bottom: 2px solid #cc0000;
}
tr.duplicate-driver:hover {
background-color: #ff6666 !important;
}
.actions-btn {
background: #1f7a4d;
color: white;
border: none;
padding: 5px 10px;
margin: 0 2px;
border-radius: 3px;
cursor: pointer;
font-size: 0.8rem;
}
.actions-btn.delete {
background: #dc2626;
}
.actions-btn:hover {
opacity: 0.8;
}
tr.duplicate-driver .actions-btn {
background: #ffffff;
color: #ff4444;
border: 2px solid #ffffff;
}
tr.duplicate-driver .actions-btn.delete {
background: #ffffff;
color: #dc2626;
}
.modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0,0,0,0.5);
z-index: 1000;
}
.modal.active {
display: flex;
justify-content: center;
align-items: center;
}
.modal-content {
background: white;
padding: 30px;
border-radius: 8px;
box-shadow: 0 4px 20px rgba(0,0,0,0.3);
max-width: 600px;
width: 90%;
}
.modal-content h3 {
margin-top: 0;
color: #0b3d2e;
}
.modal-form {
display: grid;
grid-template-columns: 1fr;
gap: 15px;
}
.modal-buttons {
display: flex;
gap: 10px;
margin-top: 20px;
}
.modal-buttons button {
flex: 1;
padding: 10px;
}
.modal-buttons .cancel {
background: #6b7280;
}

.filters-container {
background: #ffffff;
border-radius: 8px;
box-shadow: 0 4px 12px rgba(0,0,0,0.08);
margin-bottom: 20px;
overflow: hidden;
}

.filters-header {
background: #0b3d2e;
color: #ffffff;
padding: 12px 20px;
cursor: pointer;
display: flex;
justify-content: space-between;
align-items: center;
user-select: none;
}

.filters-header:hover {
background: #0d4a38;
}

.filters-header h2 {
margin: 0;
color: #ffffff;
font-size: 1rem;
text-transform: uppercase;
letter-spacing: 0.05em;
}

.filters-toggle {
font-size: 1.2rem;
transition: transform 0.3s ease;
}

.filters-toggle.collapsed {
transform: rotate(-90deg);
}

.filters-content {
max-height: 500px;
overflow: hidden;
transition: max-height 0.3s ease;
padding: 20px;
}

.filters-content.collapsed {
max-height: 0;
padding: 0 20px;
}

.filters {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
gap: 22px 32px;
align-items: center;
}

.filter-item {
display: flex;
align-items: center;
gap: 14px;
}

.filter-item label {
min-width: 110px;
font-weight: 600;
font-size: 0.85rem;
color: #0b3d2e;
white-space: nowrap;
}

.filter-item select {
flex: 1;
min-width: 200px;
}

.filter-item input[type="text"] {
flex: 1;
min-width: 200px;
}

.filter-actions {
display: flex;
justify-content: flex-end;
}

#resetFiltersBtn {
border: none;
padding: 10px 18px;
border-radius: 5px;
cursor: pointer;
}

.company-input-wrapper {
position: relative;
display: flex;
gap: 10px;
}

.company-input-wrapper input {
flex: 1;
}

.company-input-wrapper select {
flex: 1;
}

.search-highlight {
background-color: yellow;
font-weight: bold;
}

</style>
</head>
<body>
<h1>Driver Records</h1>

<div class="form-section">
<form id="driverForm">
<div>
<label>First Name</label>
<input type="text" id="firstName" required />
</div>
<div>
<label>Middle Name(s)</label>
<input type="text" id="middleName" />
</div>
<div>
<label>Last Name</label>
<input type="text" id="lastName" />
</div>
<div>
<label>Last 3 of Driver's License</label>
<input type="text" id="license" maxlength="3" required />
</div>
<div style="grid-column: span 2;">
<label>Company</label>
<div class="company-input-wrapper">
<select id="companySelect">
<option value="">Select or type new...</option>
</select>
<input type="text" id="company" placeholder="Or type new company name" />
</div>
</div>
<div style="grid-column: span 2;">
<label>Permit Start <span class="optional-hint">(optional - defaults to today)</span></label>
<input type="date" id="dateEntered" />
</div>
<button type="submit">Add Driver</button>
</form>
<div class="sidebar">
<div class="record-counter">
<h3>Records</h3>
<div class="count" id="recordCount">0</div>
<div class="label">Displayed</div>
</div>
<div class="import-export-box">
<div class="csv-buttons">
<button onclick="exportCSV()">Export to CSV</button>
<button onclick="document.getElementById('csvFile').click();">Import from CSV</button>
<input type="file" id="csvFile" accept=".csv" style="display: none;" />
</div>
</div>
</div>
</div>

<div class="filters-container">
<div class="filters-header" onclick="toggleFilters()">
<h2>Filter & Search Records</h2>
<span class="filters-toggle collapsed">▼</span>
</div>
<div class="filters-content collapsed">
<div class="filters">
<div class="filter-item">
<label for="filterLicense">License</label>
<select id="filterLicense" onchange="applyFilters()">
<option value="">All</option>
</select>
</div>

<div class="filter-item">
<label for="filterSearch">Search All Fields</label>
<input type="text" id="filterSearch" placeholder="Search any field..." oninput="applyFilters()" />
</div>

<div class="filter-item">
<label for="filterCompany">Company</label>
<select id="filterCompany" onchange="applyFilters()">
<option value="">All</option>
</select>
</div>

<div class="filter-item">
<label for="filterFirstName">First Name</label>
<select id="filterFirstName" onchange="applyFilters()">
<option value="">All</option>
</select>
</div>

<div class="filter-item">
<label for="filterDriverID">Driver ID</label>
<select id="filterDriverID" onchange="applyFilters()">
<option value="">All</option>
</select>
</div>

<div class="filter-item">
<label for="filterMiddleName">Middle Name</label>
<select id="filterMiddleName" onchange="applyFilters()">
<option value="">All</option>
</select>
</div>

<div class="filter-item">
<label for="filterDate">Date Entered</label>
<select id="filterDate" onchange="applyFilters()">
<option value="">All</option>
</select>
</div>

<div class="filter-item">
<label for="filterLastName">Last Name</label>
<select id="filterLastName" onchange="applyFilters()">
<option value="">All</option>
</select>
</div>
</div>
<div class="filter-actions">
<button id="resetFiltersBtn" onclick="resetFilters()">Reset Filters</button>
</div>
</div>
</div>

<h2>Driver Records</h2>
<table>
<thead>
<tr>
<th class="sortable" data-column="0">First<span class="sort-arrow"></span></th>
<th class="sortable" data-column="1">Middle<span class="sort-arrow"></span></th>
<th class="sortable" data-column="2">Last<span class="sort-arrow"></span></th>
<th class="sortable" data-column="3">License<span class="sort-arrow"></span></th>
<th class="sortable" data-column="4">Companies<span class="sort-arrow"></span></th>
<th class="sortable" data-column="5">Driver ID<span class="sort-arrow"></span></th>
<th class="sortable" data-column="6">Date Entered<span class="sort-arrow"></span></th>
<th>Actions</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<div id="editModal" class="modal">
<div class="modal-content">
<h3>Edit Driver</h3>
<form id="editForm" class="modal-form">
<div>
<label>First Name</label>
<input type="text" id="editFirstName" required />
</div>
<div>
<label>Middle Name</label>
<input type="text" id="editMiddleName" />
</div>
<div>
<label>Last Name</label>
<input type="text" id="editLastName" />
</div>
<div>
<label>Last 3 of License</label>
<input type="text" id="editLicense" maxlength="3" required />
</div>
<div>
<label>Companies (comma-separated)</label>
<input type="text" id="editCompany" />
</div>
<div class="modal-buttons">
<button type="submit">Save</button>
<button type="button" class="cancel" onclick="closeEditModal()">Cancel</button>
</div>
</form>
</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<script>
let drivers = [];
let editingIndex = -1;
let sortState = { column: null, asc: true };

const form = document.getElementById('driverForm');
const tbody = document.getElementById('tbody');
const firstName = document.getElementById('firstName');
const middleName = document.getElementById('middleName');
const lastName = document.getElementById('lastName');
const companySelect = document.getElementById('companySelect');
const companyInput = document.getElementById('company');
const filterSearch = document.getElementById('filterSearch');
const filterFirstName = document.getElementById('filterFirstName');
const filterMiddleName = document.getElementById('filterMiddleName');
const filterLastName = document.getElementById('filterLastName');
const filterLicense = document.getElementById('filterLicense');
const filterCompany = document.getElementById('filterCompany');
const filterDriverID = document.getElementById('filterDriverID');
const filterDate = document.getElementById('filterDate');
const editFirstName = document.getElementById('editFirstName');
const editMiddleName = document.getElementById('editMiddleName');
const editLastName = document.getElementById('editLastName');
const editLicense = document.getElementById('editLicense');
const editCompany = document.getElementById('editCompany');
const editDateEntered = document.getElementById('editDateEntered');

/* ---------------- STORAGE ---------------- */
function loadDrivers() {
const stored = localStorage.getItem('drivers');
drivers = stored ? JSON.parse(stored) : [];
}

function saveDrivers() {
localStorage.setItem('drivers', JSON.stringify(drivers));
}

/* ---------------- UTILITIES ---------------- */
function generateDriverID(first, middle, last, license) {
return `${first[0]}${middle ? middle[0] : last[0]}${last[0]}${license}`.toUpperCase();
}

function normalizeCompanies(list) {
return [...new Set(list.map(c => c.trim()).filter(Boolean))];
}

function splitName(nameValue) {
const parts = nameValue.trim().split(/\s+/);
if (parts.length === 1) {
return { first: parts[0], middle: '', last: '' };
} else if (parts.length === 2) {
return { first: parts[0], middle: '', last: parts[1] };
} else {
return {
first: parts[0],
middle: parts.slice(1, -1).join(' '),
last: parts[parts.length - 1]
};
}
}

function escapeHtml(text) {
const div = document.createElement('div');
div.textContent = text;
return div.innerHTML;
}

function highlightText(text, searchTerm) {
if (!searchTerm) return escapeHtml(text);
const escaped = escapeHtml(text);
const regex = new RegExp(`(${searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
return escaped.replace(regex, '<span class="search-highlight">$1</span>');
}

/* ---------------- COMPANY DROPDOWN ---------------- */
function updateCompanyDropdown() {
const allCompanies = [...new Set(drivers.flatMap(d => d.companies))].sort();
const currentValue = companySelect.value;
companySelect.innerHTML = '<option value="">Select or type new...</option>';
allCompanies.forEach(comp => {
if (comp) {
const opt = document.createElement('option');
opt.value = comp;
opt.textContent = comp;
companySelect.appendChild(opt);
}
});
// If there's an active company filter, set it as default
const filterCompany = document.getElementById('filterCompany');
if (filterCompany && filterCompany.value) {
companySelect.value = filterCompany.value;
companyInput.value = '';
} else if (currentValue && allCompanies.includes(currentValue)) {
companySelect.value = currentValue;
}
}

companySelect.addEventListener('change', function() {
if (this.value) {
companyInput.value = '';
}
});

companyInput.addEventListener('input', function() {
if (this.value) {
companySelect.value = '';
}
});

/* ---------------- RENDER ---------------- */
function renderTable() {
tbody.innerHTML = '';

// Map driverID → unique companies
const companyMap = {};
drivers.forEach(d => {
if (!companyMap[d.driverID]) companyMap[d.driverID] = new Set();
d.companies.forEach(c => companyMap[d.driverID].add(c));
});

const searchTerm = filterSearch.value.trim();
const firstNameTerm = filterFirstName.value;
const middleNameTerm = filterMiddleName.value;
const lastNameTerm = filterLastName.value;
const licenseTerm = filterLicense.value;
const companyTerm = filterCompany.value;
const idTerm = filterDriverID.value;
const dateTerm = filterDate.value;

drivers.forEach((d, i) => {
const tr = document.createElement('tr');

if (companyMap[d.driverID].size > 1) {
tr.classList.add('duplicate-driver');
}

// Determine which term to highlight for each field (prioritize specific filter over search all)
const firstHighlight = firstNameTerm || searchTerm;
const middleHighlight = middleNameTerm || searchTerm;
const lastHighlight = lastNameTerm || searchTerm;
const licenseHighlight = licenseTerm || searchTerm;
const companyHighlight = companyTerm || searchTerm;
const idHighlight = idTerm || searchTerm;
const dateHighlight = dateTerm || searchTerm;

tr.innerHTML = `
<td>${highlightText(d.first, firstHighlight)}</td>
<td>${highlightText(d.middle, middleHighlight)}</td>
<td>${highlightText(d.last, lastHighlight)}</td>
<td>${highlightText(d.license, licenseHighlight)}</td>
<td>${highlightText(d.companies.join(', '), companyHighlight)}</td>
<td>${highlightText(d.driverID, idHighlight)}</td>
<td>${highlightText(d.dateEntered, dateHighlight)}</td>
<td>
<button class="actions-btn" onclick="editDriver(${i})">Edit</button>
<button class="actions-btn delete" onclick="deleteDriver(${i})">Delete</button>
</td>
`;
tbody.appendChild(tr);
});

document.getElementById('recordCount').textContent = drivers.length;
updateSortArrows();
}

/* ---------------- ADD ---------------- */
form.addEventListener('submit', e => {
e.preventDefault();

let first = firstName.value.trim();
let middle = middleName.value.trim();
let last = lastName.value.trim();
// Auto-split first name if it contains spaces and last name is empty
if (first.includes(' ') && !last) {
const split = splitName(first);
first = split.first;
middle = middle || split.middle; // Keep existing middle name if provided
last = split.last;
}

const license = document.getElementById('license').value.trim();

// Get company from either dropdown or text input
let companyValue = companySelect.value || companyInput.value;
const companies = normalizeCompanies(companyValue.split(','));
const dateEntered = dateEnteredInput.value
? new Date(dateEnteredInput.value).toLocaleDateString()
: new Date().toLocaleDateString();

drivers.push({
first,
middle,
last,
license,
companies,
driverID: generateDriverID(first, middle, last, license),
dateEntered
});

saveDrivers();
renderTable();
form.reset();
companySelect.value = '';
updateCompanyDropdown();
});

/* ---------------- EDIT ---------------- */
function editDriver(index) {
editingIndex = index;
const d = drivers[index];

editFirstName.value = d.first;
editMiddleName.value = d.middle;
editLastName.value = d.last;
editLicense.value = d.license;
editCompany.value = d.companies.join(', ');
editDateEntered.value = '';

document.getElementById('editModal').classList.add('active');
}

document.getElementById('editForm').addEventListener('submit', e => {
e.preventDefault();
const d = drivers[editingIndex];

d.first = editFirstName.value.trim();
d.middle = editMiddleName.value.trim();
d.last = editLastName.value.trim();
d.license = editLicense.value.trim();
d.companies = normalizeCompanies(editCompany.value.split(','));
d.driverID = generateDriverID(d.first, d.middle, d.last, d.license);

saveDrivers();
closeEditModal();
renderTable();
});

function closeEditModal() {
editingIndex = -1;
document.getElementById('editModal').classList.remove('active');
}

/* ---------------- DELETE ---------------- */
function deleteDriver(index) {
if (!confirm('Delete this record?')) return;
drivers.splice(index, 1);
saveDrivers();
renderTable();
}

/* ---------------- SORT ---------------- */
document.querySelectorAll('th.sortable').forEach(th => {
th.onclick = () => sortTable(parseInt(th.dataset.column));
});

function sortTable(col) {
const keys = ['first','middle','last','license','companies','driverID','dateEntered'];
const key = keys[col];

sortState.asc = sortState.column === key ? !sortState.asc : true;
sortState.column = key;

drivers.sort((a, b) => {
let A = key === 'companies' ? a[key].join(', ') : a[key];
let B = key === 'companies' ? b[key].join(', ') : b[key];
return sortState.asc ? A.localeCompare(B) : B.localeCompare(A);
});

renderTable();
}

function updateSortArrows() {
document.querySelectorAll('th .sort-arrow').forEach(arrow => {
arrow.textContent = '';
});
if (sortState.column !== null) {
const keys = ['first','middle','last','license','companies','driverID','dateEntered'];
const colIndex = keys.indexOf(sortState.column);
const th = document.querySelector(`th[data-column="${colIndex}"]`);
if (th) {
const arrow = th.querySelector('.sort-arrow');
arrow.textContent = sortState.asc ? '▲' : '▼';
}
}
}

/* ---------------- FILTER TOGGLE ---------------- */
function toggleFilters() {
const content = document.querySelector('.filters-content');
const toggle = document.querySelector('.filters-toggle');
content.classList.toggle('collapsed');
toggle.classList.toggle('collapsed');
}

/* ---------------- INIT ---------------- */
const dateEnteredInput = document.getElementById('dateEntered');
loadDrivers();
renderTable();
populateFilters();
applyFilters();
updateCompanyDropdown();

/* ---------------- FILTER SUPPORT ---------------- */
function populateFilters() {
populateSelect('filterFirstName', drivers.map(d => d.first));
populateSelect('filterMiddleName', drivers.map(d => d.middle).filter(Boolean));
populateSelect('filterLastName', drivers.map(d => d.last));
populateSelect('filterLicense', drivers.map(d => d.license));
populateSelect('filterCompany', drivers.flatMap(d => d.companies));
populateSelect('filterDriverID', drivers.map(d => d.driverID));
populateSelect('filterDate', drivers.map(d => d.dateEntered));
}

function populateSelect(id, values) {
const select = document.getElementById(id);
const current = select.value;
select.innerHTML = '<option value="">All</option>';
[...new Set(values)].sort().forEach(v => {
if (!v && v !== '') return;
const opt = document.createElement('option');
opt.value = v;
opt.textContent = v || '(blank)';
select.appendChild(opt);
});
select.value = current;
}

function applyFilters() {
const searchVal = filterSearch.value.toLowerCase().trim();
const firstNameVal = filterFirstName.value;
const middleNameVal = filterMiddleName.value;
const lastNameVal = filterLastName.value;
const licenseVal = filterLicense.value;
const companyVal = filterCompany.value;
const idVal = filterDriverID.value;
const dateVal = filterDate.value;

[...tbody.rows].forEach((row, i) => {
const d = drivers[i];
let show = true;

// Individual field filters (exact match for dropdowns)
if (firstNameVal && d.first !== firstNameVal) show = false;
if (middleNameVal && d.middle !== middleNameVal) show = false;
if (lastNameVal && d.last !== lastNameVal) show = false;
if (licenseVal && d.license !== licenseVal) show = false;
if (companyVal && !d.companies.includes(companyVal)) show = false;
if (idVal && d.driverID !== idVal) show = false;
if (dateVal && d.dateEntered !== dateVal) show = false;

// Search all fields
if (searchVal) {
const searchableText = [
d.first,
d.middle,
d.last,
d.license,
d.companies.join(' '),
d.driverID,
d.dateEntered
].join(' ').toLowerCase();
if (!searchableText.includes(searchVal)) show = false;
}

row.style.display = show ? '' : 'none';
});

document.getElementById('recordCount').textContent =
[...tbody.rows].filter(r => r.style.display !== 'none').length;
// Update company dropdown based on filter
updateCompanyDropdown();
}

/* ---------------- EXPORT ---------------- */
function exportCSV() {
const rows = [
['First','Middle','Last','License','Companies','Driver ID','Date Entered'],
...drivers.map(d => [
d.first,
d.middle,
d.last,
d.license,
d.companies.join(', '),
d.driverID,
d.dateEntered
])
];

const csv = Papa.unparse(rows);
const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
const url = URL.createObjectURL(blob);

const a = document.createElement('a');
a.href = url;
a.download = `driver_records_${new Date().toISOString().slice(0,10)}.csv`;
a.click();

URL.revokeObjectURL(url);
}

/* ---------------- IMPORT ---------------- */
document.getElementById('csvFile').addEventListener('change', function(e) {
const file = e.target.files[0];
if (!file) return;

Papa.parse(file, {
complete: function(results) {
const data = results.data;
if (data.length < 2) return;

// Skip header row
for (let i = 1; i < data.length; i++) {
const row = data[i];
if (row.length < 7 || !row[0]) continue;

drivers.push({
first: row[0],
middle: row[1],
last: row[2],
license: row[3],
companies: normalizeCompanies(row[4].split(',')),
driverID: row[5],
dateEntered: row[6]
});
}

saveDrivers();
renderTable();
e.target.value = '';
}
});
});

function resetFilters(){
filterSearch.value = '';
filterFirstName.value = '';
filterMiddleName.value = '';
filterLastName.value = '';
filterLicense.value = '';
filterCompany.value = '';
filterDriverID.value = '';
filterDate.value = '';

originalRender();
populateFilters();
applyFilters();
}

/* --- Hook filters back into render cycle --- */
const originalRender = renderTable;
renderTable = function () {
originalRender();
populateFilters();
applyFilters();
updateCompanyDropdown();
};

</script>
</body>
</html>
